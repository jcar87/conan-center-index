name: 2.0 Migration Effort Check

on:
  push:

jobs:
  ubuntu:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: setup python
      uses: actions/setup-python@v4
      with:
        python-version: 3.9 # Should be 3.6 for 2.0 min (my code uses 3.9 features)
    - name: install cmake
      uses: lukka/get-cmake@latest # Should be set to CMake 3.15 which is the min for 2.0

    - run: python3 -m pip install conan==2.0.0b6
    - name: conan config
      run: |
        echo '## ConanCenterIndex 2.0 Migration Effort' >> $GITHUB_STEP_SUMMARY
        echo 'This workflow will export and build all the package the represent (or are required for) the top 80% or downloaded packages' >> $GITHUB_STEP_SUMMARY
        conan config home
        conan config install .conan
        conan profile detect --name default

    - name: conan export
      run: conan cci:export-all-versions --list=.github/top_100_recipes.yaml -f md >> $GITHUB_STEP_SUMMARY

    - name: conan create
      run: conan cci:create-top-versions --list=.github/top_100_recipes.yaml -s complier.cppstd=14 -f md >> $GITHUB_STEP_SUMMARY
